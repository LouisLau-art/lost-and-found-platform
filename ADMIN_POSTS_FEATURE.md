# ç®¡ç†å‘˜å¸–å­ç®¡ç†åŠŸèƒ½

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æ–°å¢äº†ç®¡ç†å‘˜åå°å¸–å­ç®¡ç†åŠŸèƒ½,å…è®¸ç®¡ç†å‘˜æŸ¥çœ‹ã€ç¼–è¾‘å’Œåˆ é™¤æ‰€æœ‰ç”¨æˆ·å‘å¸ƒçš„å¸–å­ã€‚

---

## ğŸ¯ å®ç°çš„åŠŸèƒ½

### åç«¯ API (FastAPI)

#### 1. ç®¡ç†å‘˜ä¾èµ–æ³¨å…¥
**æ–‡ä»¶**: `backend/app/core/deps.py`

å·²æœ‰çš„ `get_current_admin_user` ä¾èµ–å‡½æ•°ä¼š:
- âœ… éªŒè¯ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
- âœ… æ£€æŸ¥ç”¨æˆ·çš„ `is_admin` å­—æ®µ
- âœ… å¦‚æœä¸æ˜¯ç®¡ç†å‘˜,æŠ›å‡º 403 Forbidden é”™è¯¯

#### 2. ç®¡ç†å‘˜å¸–å­ API
**æ–‡ä»¶**: `backend/app/api/admin/posts.py`

**ç«¯ç‚¹åˆ—è¡¨**:

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | æƒé™è¦æ±‚ |
|------|------|------|----------|
| GET | `/api/admin/posts` | è·å–æ‰€æœ‰å¸–å­åˆ—è¡¨ | ç®¡ç†å‘˜ |
| DELETE | `/api/admin/posts/{post_id}` | åˆ é™¤ä»»æ„å¸–å­ | ç®¡ç†å‘˜ |
| PUT | `/api/admin/posts/{post_id}` | ç¼–è¾‘ä»»æ„å¸–å­ | ç®¡ç†å‘˜ |

**ç‰¹æ€§**:
- âœ… æ‰€æœ‰ç«¯ç‚¹éƒ½ä½¿ç”¨ `Depends(get_current_admin_user)` ä¿æŠ¤
- âœ… æ”¯æŒåˆ†é¡µ (skip/limit å‚æ•°)
- âœ… å¯ä»¥æŸ¥çœ‹åŒ…æ‹¬å·²åˆ é™¤åœ¨å†…çš„æ‰€æœ‰å¸–å­
- âœ… ç®¡ç†å‘˜å¯ä»¥ç¼–è¾‘ä»»ä½•äººçš„å¸–å­
- âœ… ç®¡ç†å‘˜å¯ä»¥åˆ é™¤ä»»ä½•äººçš„å¸–å­(è½¯åˆ é™¤)

**API ç¤ºä¾‹**:

```bash
# è·å–å¸–å­åˆ—è¡¨
GET /api/admin/posts?skip=0&limit=10
Authorization: Bearer {admin_token}

# åˆ é™¤å¸–å­
DELETE /api/admin/posts/123
Authorization: Bearer {admin_token}

# ç¼–è¾‘å¸–å­
PUT /api/admin/posts/123
Authorization: Bearer {admin_token}
Content-Type: application/json

{
  "title": "æ›´æ–°åçš„æ ‡é¢˜",
  "content": "æ›´æ–°åçš„å†…å®¹",
  "status": "published"
}
```

---

### å‰ç«¯ç•Œé¢ (Vue.js)

#### 1. ç®¡ç†å‘˜å¸–å­è§†å›¾
**æ–‡ä»¶**: `frontend/src/views/admin/AdminPostsView.vue`

**åŠŸèƒ½**:
- âœ… ä½¿ç”¨ Element Plus `<el-table>` å±•ç¤ºå¸–å­åˆ—è¡¨
- âœ… æ˜¾ç¤ºå¸–å­çš„ IDã€æ ‡é¢˜ã€ä½œè€…ã€ç±»å‹ã€çŠ¶æ€ã€è®¤é¢†çŠ¶æ€ã€åˆ›å»ºæ—¶é—´
- âœ… æ¯è¡Œæœ‰"ç¼–è¾‘"å’Œ"åˆ é™¤"æ“ä½œæŒ‰é’®
- âœ… åˆ é™¤å‰ä½¿ç”¨ `<el-popconfirm>` ç¡®è®¤
- âœ… ç¼–è¾‘åŠŸèƒ½ä½¿ç”¨å¯¹è¯æ¡†
- âœ… åˆ†é¡µåŠŸèƒ½
- âœ… å“åº”å¼è®¾è®¡,é€‚é…æ·±è‰²ä¸»é¢˜

**è¡¨æ ¼åˆ—**:
1. **ID** - å¸–å­ID
2. **æ ‡é¢˜** - å¯ç‚¹å‡»è·³è½¬åˆ°è¯¦æƒ…é¡µ
3. **ä½œè€…** - æ˜¾ç¤ºå¤´åƒå’Œåå­—
4. **ç±»å‹** - ä¸¢å¤±/æ‹¾åˆ°/æ™®é€š (å¸¦é¢œè‰²æ ‡ç­¾)
5. **çŠ¶æ€** - å·²å‘å¸ƒ/å·²åˆ é™¤ (å¸¦é¢œè‰²æ ‡ç­¾)
6. **æ˜¯å¦è®¤é¢†** - å·²è®¤é¢†/æœªè®¤é¢†
7. **åˆ›å»ºæ—¶é—´** - æ ¼å¼åŒ–æ˜¾ç¤º
8. **æ“ä½œ** - ç¼–è¾‘/åˆ é™¤æŒ‰é’®

#### 2. è·¯ç”±é…ç½®
**æ–‡ä»¶**: `frontend/src/router/index.js`

**æ–°å¢è·¯ç”±**:
```javascript
{
  path: '/admin/posts',
  name: 'admin-posts',
  component: () => import('../views/admin/AdminPostsView.vue'),
  meta: { requiresAuth: true, requiresAdmin: true }
}
```

**è·¯ç”±å®ˆå«å¢å¼º**:
- âœ… æ£€æŸ¥ `requiresAdmin` å…ƒæ•°æ®
- âœ… éªŒè¯ `authStore.user?.is_admin` æ˜¯å¦ä¸º true
- âœ… éç®¡ç†å‘˜è®¿é—®æ—¶é‡å®šå‘åˆ° `/dashboard`

#### 3. Dashboard é›†æˆ
**æ–‡ä»¶**: `frontend/src/views/user/DashboardView.vue`

**ä¿®æ”¹**:
- âœ… ç®¡ç†å‘˜é¢æ¿ä¸­çš„"å¸–å­ç®¡ç†"æŒ‰é’®è·³è½¬åˆ° `/admin/posts`
- âœ… é¡¶éƒ¨å¯¼èˆªæ çš„"ç®¡ç†åå°"é“¾æ¥

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### å‰ææ¡ä»¶

ç¡®ä¿ä½ æœ‰ä¸€ä¸ªç®¡ç†å‘˜è´¦å·ã€‚æ£€æŸ¥æ•°æ®åº“ä¸­ç”¨æˆ·çš„ `is_admin` å­—æ®µæ˜¯å¦ä¸º `true`ã€‚

**è®¾ç½®ç®¡ç†å‘˜**:

æ–¹æ³• 1: ç›´æ¥åœ¨æ•°æ®åº“ä¸­è®¾ç½®
```sql
UPDATE user SET is_admin = 1 WHERE email = 'admin@example.com';
```

æ–¹æ³• 2: ä½¿ç”¨åç«¯è„šæœ¬ (å¦‚æœæœ‰)

### è®¿é—®ç®¡ç†å‘˜åå°

#### æ­¥éª¤ 1: ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•
```
è®¿é—®: http://localhost:5173/login
ç™»å½•ç®¡ç†å‘˜è´¦å·
```

#### æ­¥éª¤ 2: è¿›å…¥ç®¡ç†å‘˜åå°

**æ–¹æ³• A: ä» Dashboard**
1. ç™»å½•åè‡ªåŠ¨è·³è½¬åˆ° Dashboard
2. æ‰¾åˆ°"ç®¡ç†å‘˜é¢æ¿"å¡ç‰‡
3. ç‚¹å‡»"å¸–å­ç®¡ç†"æŒ‰é’®

**æ–¹æ³• B: ç›´æ¥è®¿é—®**
```
è®¿é—®: http://localhost:5173/admin/posts
```

#### æ­¥éª¤ 3: ç®¡ç†å¸–å­

**æŸ¥çœ‹å¸–å­åˆ—è¡¨**:
- è¡¨æ ¼è‡ªåŠ¨åŠ è½½æ‰€æœ‰å¸–å­
- æ”¯æŒåˆ†é¡µ,å¯é€‰æ‹©æ¯é¡µæ˜¾ç¤º 10/20/50/100 æ¡

**ç¼–è¾‘å¸–å­**:
1. ç‚¹å‡»å¸–å­è¡Œçš„"ç¼–è¾‘"æŒ‰é’®
2. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ä¿®æ”¹:
   - æ ‡é¢˜
   - å†…å®¹
   - ç‰©å“ç±»å‹ (ä¸¢å¤±/æ‹¾åˆ°/æ™®é€š)
   - çŠ¶æ€ (å·²å‘å¸ƒ/å·²åˆ é™¤)
3. ç‚¹å‡»"ä¿å­˜"

**åˆ é™¤å¸–å­**:
1. ç‚¹å‡»å¸–å­è¡Œçš„"åˆ é™¤"æŒ‰é’®
2. åœ¨ç¡®è®¤å¯¹è¯æ¡†ä¸­ç‚¹å‡»"ç¡®å®š"
3. å¸–å­çŠ¶æ€å˜ä¸º"å·²åˆ é™¤"(è½¯åˆ é™¤)

---

## ğŸ” æƒé™æ§åˆ¶

### åç«¯æƒé™

**æ‰€æœ‰ç®¡ç†å‘˜ API éƒ½å—ä¿æŠ¤**:

```python
@router.get("/posts")
def admin_list_posts(
    current_admin: User = Depends(get_current_admin_user),  # â† ç®¡ç†å‘˜éªŒè¯
    session: Session = Depends(get_session)
):
    # ... åªæœ‰ç®¡ç†å‘˜æ‰èƒ½æ‰§è¡Œ
```

**éªŒè¯æµç¨‹**:
1. æ£€æŸ¥ JWT Token æ˜¯å¦æœ‰æ•ˆ
2. ä» Token ä¸­è·å–ç”¨æˆ· ID
3. ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·
4. æ£€æŸ¥ `user.is_admin == True`
5. å¦‚æœä¸æ˜¯ç®¡ç†å‘˜,è¿”å› `403 Forbidden`

### å‰ç«¯æƒé™

**è·¯ç”±å®ˆå«**:

```javascript
router.beforeEach((to, from, next) => {
  // ...
  const requiresAdmin = to.matched.some(record => record.meta.requiresAdmin)
  
  // æ£€æŸ¥æ˜¯å¦éœ€è¦ç®¡ç†å‘˜æƒé™
  if (requiresAdmin && !authStore.user?.is_admin) {
    // éç®¡ç†å‘˜,é‡å®šå‘åˆ° dashboard
    if (authStore.isAuthenticated) {
      next('/dashboard')
    } else {
      next('/login')
    }
    return
  }
  // ...
})
```

**UI å…ƒç´ éšè—**:
- Dashboard ä¸­çš„"ç®¡ç†å‘˜é¢æ¿"åªå¯¹ `is_admin` ç”¨æˆ·æ˜¾ç¤º
- é¡¶éƒ¨å¯¼èˆªçš„"ç®¡ç†åå°"é“¾æ¥åªå¯¹ç®¡ç†å‘˜æ˜¾ç¤º

---

## ğŸ“Š API å“åº”æ ¼å¼

### è·å–å¸–å­åˆ—è¡¨

**è¯·æ±‚**:
```http
GET /api/admin/posts?skip=0&limit=10
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**å“åº”**:
```json
{
  "data": [
    {
      "id": 1,
      "title": "ä¸¢å¤±é’±åŒ…",
      "content": "ä»Šå¤©åœ¨å›¾ä¹¦é¦†ä¸¢å¤±é»‘è‰²é’±åŒ…...",
      "item_type": "lost",
      "status": "published",
      "is_claimed": false,
      "author_id": 2,
      "author": {
        "id": 2,
        "name": "å¼ ä¸‰",
        "email": "zhangsan@example.com"
      },
      "category_id": 6,
      "created_at": "2025-10-23T10:30:00",
      "updated_at": "2025-10-23T10:30:00"
    }
  ],
  "total": 150,
  "skip": 0,
  "limit": 10
}
```

### åˆ é™¤å¸–å­

**è¯·æ±‚**:
```http
DELETE /api/admin/posts/123
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**å“åº”**:
```json
{
  "message": "Post deleted successfully",
  "post_id": 123
}
```

### ç¼–è¾‘å¸–å­

**è¯·æ±‚**:
```http
PUT /api/admin/posts/123
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "title": "æ›´æ–°åçš„æ ‡é¢˜",
  "content": "æ›´æ–°åçš„å†…å®¹"
}
```

**å“åº”**:
```json
{
  "id": 123,
  "title": "æ›´æ–°åçš„æ ‡é¢˜",
  "content": "æ›´æ–°åçš„å†…å®¹",
  "item_type": "lost",
  "status": "published",
  "is_claimed": false,
  "author_id": 2,
  "category_id": 6,
  "created_at": "2025-10-23T10:30:00",
  "updated_at": "2025-10-23T15:45:00"
}
```

---

## ğŸ¨ UI è®¾è®¡

### æ·±è‰²ä¸»é¢˜

ç®¡ç†å‘˜é¡µé¢ä½¿ç”¨ä¸æ•´ä¸ªåº”ç”¨ä¸€è‡´çš„æ·±è‰²ä¸»é¢˜:

**é¢œè‰²æ–¹æ¡ˆ**:
- èƒŒæ™¯: `linear-gradient(135deg, #1e293b 0%, #0f172a 100%)`
- å¡ç‰‡: `linear-gradient(135deg, #1e293b 0%, #334155 100%)`
- è¡¨æ ¼è¡Œ: `#334155`
- æ‚¬åœ: `#3f4e63`
- æ–‡å­—: `#e2e8f0`

### å“åº”å¼è®¾è®¡

- æ¡Œé¢ç«¯: è¡¨æ ¼æ­£å¸¸æ˜¾ç¤ºæ‰€æœ‰åˆ—
- å¹³æ¿/ç§»åŠ¨ç«¯: æ“ä½œåˆ—å›ºå®šåœ¨å³ä¾§,å¯æ¨ªå‘æ»šåŠ¨

---

## ğŸ§ª æµ‹è¯•æ¸…å•

### åŠŸèƒ½æµ‹è¯•

- [ ] ç®¡ç†å‘˜å¯ä»¥è®¿é—® `/admin/posts`
- [ ] æ™®é€šç”¨æˆ·è®¿é—® `/admin/posts` è¢«é‡å®šå‘
- [ ] æœªç™»å½•ç”¨æˆ·è®¿é—® `/admin/posts` è¢«é‡å®šå‘åˆ°ç™»å½•é¡µ
- [ ] å¸–å­åˆ—è¡¨æ­£ç¡®åŠ è½½
- [ ] åˆ†é¡µåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] ç¼–è¾‘å¸–å­åŠŸèƒ½æ­£å¸¸
- [ ] åˆ é™¤å¸–å­åŠŸèƒ½æ­£å¸¸
- [ ] åˆ é™¤å‰å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
- [ ] è¡¨æ ¼åˆ—æ­£ç¡®æ˜¾ç¤º(ID, æ ‡é¢˜, ä½œè€…, ç±»å‹, çŠ¶æ€ç­‰)
- [ ] æ ‡é¢˜å¯ç‚¹å‡»è·³è½¬åˆ°è¯¦æƒ…é¡µ

### æƒé™æµ‹è¯•

- [ ] åç«¯ API æ‹’ç»éç®¡ç†å‘˜è¯·æ±‚ (è¿”å› 403)
- [ ] å‰ç«¯è·¯ç”±å®ˆå«é˜»æ­¢éç®¡ç†å‘˜è®¿é—®
- [ ] ç®¡ç†å‘˜é¢æ¿åªå¯¹ç®¡ç†å‘˜æ˜¾ç¤º
- [ ] JWT Token éªŒè¯æ­£å¸¸å·¥ä½œ

### UI æµ‹è¯•

- [ ] æ·±è‰²ä¸»é¢˜æ­£ç¡®åº”ç”¨
- [ ] è¡¨æ ¼æ ·å¼æ­£ç¡®
- [ ] æŒ‰é’®æ‚¬åœæ•ˆæœæ­£å¸¸
- [ ] å¯¹è¯æ¡†æ ·å¼æ­£ç¡®
- [ ] åˆ†é¡µç»„ä»¶æ ·å¼æ­£ç¡®
- [ ] å“åº”å¼å¸ƒå±€åœ¨ä¸åŒè®¾å¤‡ä¸Šæ­£å¸¸

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

```
backend/app/api/admin/
â”œâ”€â”€ __init__.py              # æ–°å»º - æ¨¡å—åˆå§‹åŒ–
â””â”€â”€ posts.py                 # æ–°å»º - ç®¡ç†å‘˜å¸–å­API (109è¡Œ)

frontend/src/views/admin/
â””â”€â”€ AdminPostsView.vue       # æ–°å»º - ç®¡ç†å‘˜å¸–å­è§†å›¾ (419è¡Œ)
```

### ä¿®æ”¹æ–‡ä»¶

```
backend/app/main.py          # ä¿®æ”¹ - æ³¨å†Œç®¡ç†å‘˜è·¯ç”±
frontend/src/router/index.js # ä¿®æ”¹ - æ·»åŠ è·¯ç”±å’Œå®ˆå«
frontend/src/views/user/DashboardView.vue # ä¿®æ”¹ - æ›´æ–°æŒ‰é’®é“¾æ¥
```

---

## ğŸš§ å·²çŸ¥é™åˆ¶å’Œåç»­æ”¹è¿›

### å½“å‰é™åˆ¶

1. **åˆ é™¤æ˜¯è½¯åˆ é™¤**: å¸–å­ä¸ä¼šä»æ•°æ®åº“ä¸­ç‰©ç†åˆ é™¤,åªæ˜¯çŠ¶æ€å˜ä¸º "deleted"
2. **ç¼–è¾‘å­—æ®µæœ‰é™**: å¯¹è¯æ¡†ä¸­åªèƒ½ç¼–è¾‘éƒ¨åˆ†å­—æ®µ(æ ‡é¢˜ã€å†…å®¹ã€ç±»å‹ã€çŠ¶æ€)
3. **æ— æ‰¹é‡æ“ä½œ**: ä¸æ”¯æŒæ‰¹é‡åˆ é™¤æˆ–æ‰¹é‡ç¼–è¾‘

### åç»­æ”¹è¿›å»ºè®®

#### çŸ­æœŸ (1-2å‘¨)

- [ ] æ·»åŠ æœç´¢å’Œç­›é€‰åŠŸèƒ½
- [ ] æ”¯æŒæŒ‰çŠ¶æ€ç­›é€‰(å·²å‘å¸ƒ/å·²åˆ é™¤)
- [ ] æ”¯æŒæŒ‰ç±»å‹ç­›é€‰(ä¸¢å¤±/æ‹¾åˆ°/æ™®é€š)
- [ ] æ·»åŠ "æ¢å¤å·²åˆ é™¤å¸–å­"åŠŸèƒ½
- [ ] ç¼–è¾‘å¯¹è¯æ¡†æ”¯æŒæ›´å¤šå­—æ®µ(åœ°ç‚¹ã€æ—¶é—´ã€è”ç³»æ–¹å¼ç­‰)

#### ä¸­æœŸ (1-2æœˆ)

- [ ] æ‰¹é‡æ“ä½œ(æ‰¹é‡åˆ é™¤ã€æ‰¹é‡ä¿®æ”¹çŠ¶æ€)
- [ ] å¯¼å‡ºå¸–å­æ•°æ®(CSV/Excel)
- [ ] å¸–å­ç»Ÿè®¡å›¾è¡¨(æŒ‰ç±»å‹ã€æŒ‰æ—¥æœŸ)
- [ ] å®¡æ ¸åŠŸèƒ½(å¾…å®¡æ ¸å¸–å­åˆ—è¡¨)
- [ ] æ“ä½œæ—¥å¿—(è®°å½•ç®¡ç†å‘˜çš„æ‰€æœ‰æ“ä½œ)

#### é•¿æœŸ (3-6æœˆ)

- [ ] é«˜çº§æœç´¢(å…¨æ–‡æœç´¢)
- [ ] å¸–å­è´¨é‡è¯„åˆ†
- [ ] è‡ªåŠ¨åŒ–ç®¡ç†(è§„åˆ™å¼•æ“)
- [ ] æ•°æ®åˆ†æå’ŒæŠ¥è¡¨
- [ ] æƒé™ç»†åŒ–(ä¸åŒçº§åˆ«çš„ç®¡ç†å‘˜)

---

## ğŸ‰ æ€»ç»“

ç®¡ç†å‘˜å¸–å­ç®¡ç†åŠŸèƒ½å·²ç»å®Œæ•´å®ç°,åŒ…æ‹¬:

âœ… **åç«¯ API** - 3ä¸ªå—ä¿æŠ¤çš„ç®¡ç†å‘˜ç«¯ç‚¹  
âœ… **å‰ç«¯ç•Œé¢** - åŠŸèƒ½å®Œæ•´çš„å¸–å­ç®¡ç†é¡µé¢  
âœ… **æƒé™æ§åˆ¶** - åç«¯å’Œå‰ç«¯åŒé‡ä¿æŠ¤  
âœ… **è·¯ç”±å®ˆå«** - è‡ªåŠ¨é‡å®šå‘éæˆæƒè®¿é—®  
âœ… **UI è®¾è®¡** - ç»Ÿä¸€çš„æ·±è‰²ä¸»é¢˜  
âœ… **ç”¨æˆ·ä½“éªŒ** - ç¡®è®¤å¯¹è¯æ¡†ã€åŠ è½½çŠ¶æ€ã€é”™è¯¯å¤„ç†  

ç®¡ç†å‘˜ç°åœ¨å¯ä»¥æ–¹ä¾¿åœ°ç®¡ç†å¹³å°ä¸Šçš„æ‰€æœ‰å¸–å­äº†! ğŸš€

---

**åˆ›å»ºæ—¶é—´**: 2025-10-23  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… å®Œæˆ
